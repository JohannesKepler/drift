<html style="margin:0; padding:0;">
	
	<body style="margin: 0; padding: 0; background: #111111;">
		<img id="img-ship" src="images/ship-med.png" style="display:none;">
		<img id="img-goal" src="images/gem-med.png" style="display:none;">
		<img id="img-planet" src="images/planet-med.png" style="display:none;">
		<img id="img-you-died" src="images/you-died-med.png" style="display:none;">
		<img id="img-you-win" src="images/you-win-med.png" style="display:none;">
		<div style="text-align: center; margin-top: 10px;">
		<canvas id="canvas" width="1200" height="600" style="margin:0; padding:0; border: 1px solid #222222;"/>
		</div>
	</body>

<script type="text/javascript" src="js/model.js"></script>
<script type="text/javascript" src="js/levels.js"></script>
<script type="text/javascript">

	const PROJECTILE_VELOCITY = 1;
	const ROT_SPEED = 0.003;
	var G = 0.02;

	var canvas = document.getElementById("canvas");
	var ctx = canvas.getContext("2d");
	var img_ship = document.getElementById('img-ship');
	var img_goal = document.getElementById('img-goal');
	var img_planet = document.getElementById('img-planet');
	var img_you_died = document.getElementById('img-you-died');
	var img_you_win = document.getElementById('img-you-win');

	function dist(a,b) {
		return Math.sqrt((b.y-a.y)**2 + (b.x - a.x)**2)
	}

	function drawShip(ship) {
		ctx.save();
		ctx.translate(ship.x, ship.y);
		ctx.rotate(ship.phi);
		ctx.drawImage(img_ship, -(img_ship.width/2),-(img_ship.height/2));
		ctx.restore();
	}

	function drawGoal(goal) {
		ctx.drawImage(img_goal, goal.x-(img_goal.width/2),goal.y-(img_goal.height/2));
	}

	function drawPlanet(planet) {
		ctx.drawImage(img_planet, planet.x-(img_planet.width/2),planet.y-(img_planet.height/2));
	}

	function drawProjectile(projectile) {
		ctx.fillStyle = "white";
		ctx.fillRect(projectile.x - projectile.size/2, projectile.y-projectile.size/2, projectile.size, projectile.size);
	}

	function draw() {

  		// Blank the screen
  		ctx.fillStyle = "black";
		ctx.fillRect(0,0,ctx.canvas.width,ctx.canvas.height);

		drawShip(model.ship);
		drawGoal(model.goal);

		model.planets.forEach(function(planet) {
			drawPlanet(planet);
		})

		model.projectiles.forEach(function(projectile) {
			drawProjectile(projectile);
		})

		ctx.fillStyle ='white';
		model.particles.forEach(particle => {
			ctx.fillRect(particle.x - 3, particle.y-3, 6, 6);

		});

		// Draw "YOU DIED" if player dies.
		if(model.state == 'dead') {
			ctx.drawImage(img_you_died, canvas.width/2-img_you_died.width/2, canvas.height/2-img_you_died.height/2)
			return;
		}

		// Draw the checkmark if player wins
		if(model.state == 'win') {
			ctx.drawImage(img_you_win, canvas.width/2-img_you_win.width/2, canvas.height/2-img_you_win.height/2)
			return;
		}



	}

	document.addEventListener('keydown', (event) => {
		switch(event.key) {
			case "ArrowRight":
			case "ArrowUp":
				model.rotateShipRight();
				break;

			case "ArrowLeft":
			case "ArrowDown":
				model.rotateShipLeft();
				break;

			case " ":
				model.fireGun();
				break;
		} 
	});

	document.addEventListener('keyup', (event) => {
		model.stopShipRotate();
	});

	function step(ts) {
		model.update(ts);
		draw();
		window.requestAnimationFrame(step);
	}

	window.onload = function() {
		model.loadLevel(levels[0]);
		window.requestAnimationFrame(step);		
	}
</script>
</html>
